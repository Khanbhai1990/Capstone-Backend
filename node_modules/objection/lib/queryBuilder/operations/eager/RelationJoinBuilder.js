'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _keys = require('babel-runtime/core-js/object/keys');

var _keys2 = _interopRequireDefault(_keys);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _create = require('babel-runtime/core-js/object/create');

var _create2 = _interopRequireDefault(_create);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _ValidationError = require('../../../model/ValidationError');

var _ValidationError2 = _interopRequireDefault(_ValidationError);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var columnInfo = (0, _create2.default)(null);
var idLengthLimit = 63;
var relationRecursionLimit = 64;

var RelationJoinBuilder = function () {
  function RelationJoinBuilder(_ref) {
    var modelClass = _ref.modelClass,
        expression = _ref.expression,
        opt = _ref.opt;
    (0, _classCallCheck3.default)(this, RelationJoinBuilder);

    this.rootModelClass = modelClass;
    this.expression = expression;
    this.allRelations = null;

    this.pathInfo = (0, _create2.default)(null);
    this.encodings = (0, _create2.default)(null);
    this.decodings = (0, _create2.default)(null);
    this.encIdx = 0;

    this.opt = _lodash2.default.defaults(opt, {
      minimize: false,
      separator: ':',
      aliases: {}
    });
  }

  RelationJoinBuilder.prototype.clone = function clone(props) {
    props = props || {};

    var copy = new RelationJoinBuilder({
      modelClass: this.rootModelClass,
      expression: props.expression || this.expression,
      opt: props.opt || this.opt
    });

    copy.allRelations = this.allRelations;
    copy.pathInfo = this.pathInfo;
    copy.encodings = this.encodings;
    copy.decodings = this.decodings;
    copy.encIdx = this.encIdx;

    return copy;
  };

  /**
   * Fetches the column information needed for building the select clauses.
   * This must be called before calling `build`. `buildJoinOnly` can be called
   * without this since it doesn't build joins.
   */


  RelationJoinBuilder.prototype.fetchColumnInfo = function fetchColumnInfo(knex) {
    var allModelClasses = findAllModels(this.expression, this.rootModelClass);

    return _bluebird2.default.all(allModelClasses.map(function (ModelClass) {
      var table = ModelClass.tableName;

      if (columnInfo[table]) {
        return columnInfo[table];
      } else {
        columnInfo[table] = knex(table).columnInfo().then(function (info) {
          var result = {
            columns: (0, _keys2.default)(info)
          };

          columnInfo[table] = result;
          return result;
        });

        return columnInfo[table];
      }
    }));
  };

  RelationJoinBuilder.prototype.buildJoinOnly = function buildJoinOnly(builder) {
    this.doBuild({
      expr: this.expression,
      builder: builder,
      modelClass: builder.modelClass(),
      joinOperation: this.opt.joinOperation || 'leftJoin',
      parentInfo: null,
      relation: null,
      noSelects: true,
      path: ''
    });
  };

  RelationJoinBuilder.prototype.build = function build(builder) {
    var builderClone = builder.clone();

    builder.table(this.rootModelClass.tableName + ' as ' + this.rootModelClass.tableName);
    builder.findOptions({ callAfterGetDeeply: true });

    this.doBuild({
      expr: this.expression,
      builder: builder,
      modelClass: builder.modelClass(),
      joinOperation: this.opt.joinOperation || 'leftJoin',
      parentInfo: null,
      relation: null,
      path: '',
      selectFilter: function selectFilter(col) {
        return builderClone.hasSelection(col);
      }
    });
  };

  RelationJoinBuilder.prototype.rowsToTree = function rowsToTree(rows) {
    if (_lodash2.default.isEmpty(rows)) {
      return rows;
    }

    var keyInfoByPath = this.createKeyInfo(rows);
    var pathInfo = _lodash2.default.values(this.pathInfo);

    var tree = (0, _create2.default)(null);
    var stack = (0, _create2.default)(null);

    for (var i = 0, lr = rows.length; i < lr; ++i) {
      var row = rows[i];
      var curBranch = tree;

      for (var j = 0, lp = pathInfo.length; j < lp; ++j) {
        var pInfo = pathInfo[j];
        var id = pInfo.idGetter(row);

        if (!id) {
          continue;
        }

        if (pInfo.relation) {
          var parentModel = stack[pInfo.encParentPath];

          curBranch = pInfo.getBranch(parentModel);

          if (!curBranch) {
            curBranch = pInfo.createBranch(parentModel);
          }
        }

        var model = pInfo.getModelFromBranch(curBranch, id);

        if (!model) {
          model = createModel(row, pInfo, keyInfoByPath);
          pInfo.setModelToBranch(curBranch, id, model);
        }

        stack[pInfo.encPath] = model;
      }
    }

    return this.finalize(pathInfo[0], _lodash2.default.values(tree));
  };

  RelationJoinBuilder.prototype.createKeyInfo = function createKeyInfo(rows) {
    var keys = (0, _keys2.default)(rows[0]);
    var keyInfo = [];

    for (var i = 0, l = keys.length; i < l; ++i) {
      var key = keys[i];
      var sepIdx = key.lastIndexOf(this.sep);

      if (sepIdx === -1) {
        var pInfo = this.pathInfo[''];
        var col = key;

        if (!pInfo.omitCols[col]) {
          keyInfo.push({
            pInfo: pInfo,
            key: key,
            col: col
          });
        }
      } else {
        var encPath = key.substr(0, sepIdx);
        var path = this.decode(encPath);
        var _col = key.substr(sepIdx + 1);
        var _pInfo = this.pathInfo[path];

        if (!_pInfo.omitCols[_col]) {
          keyInfo.push({
            pInfo: _pInfo,
            key: key,
            col: _col
          });
        }
      }
    }

    return _lodash2.default.groupBy(keyInfo, function (kInfo) {
      return kInfo.pInfo.encPath;
    });
  };

  RelationJoinBuilder.prototype.finalize = function finalize(pInfo, models) {
    var relNames = (0, _keys2.default)(pInfo.children);

    if (Array.isArray(models)) {
      for (var m = 0, lm = models.length; m < lm; ++m) {
        this.finalizeOne(pInfo, relNames, models[m]);
      }
    } else if (models) {
      this.finalizeOne(pInfo, relNames, models);
    }

    return models;
  };

  RelationJoinBuilder.prototype.finalizeOne = function finalizeOne(pInfo, relNames, model) {
    for (var r = 0, lr = relNames.length; r < lr; ++r) {
      var relName = relNames[r];
      var branch = model[relName];
      var childPathInfo = pInfo.children[relName];

      var finalized = childPathInfo.finalizeBranch(branch, model);
      this.finalize(childPathInfo, finalized);
    }
  };

  RelationJoinBuilder.prototype.doBuild = function doBuild(_ref2) {
    var _this = this;

    var expr = _ref2.expr,
        builder = _ref2.builder,
        selectFilter = _ref2.selectFilter,
        modelClass = _ref2.modelClass,
        relation = _ref2.relation,
        path = _ref2.path,
        parentInfo = _ref2.parentInfo,
        joinOperation = _ref2.joinOperation,
        noSelects = _ref2.noSelects;

    if (!this.allRelations) {
      this.allRelations = findAllRelations(this.expression, this.rootModelClass);
    }

    var info = this.createPathInfo({
      modelClass: modelClass,
      path: path,
      relation: relation,
      parentInfo: parentInfo
    });

    this.pathInfo[path] = info;

    if (!noSelects) {
      this.buildSelects({
        builder: builder,
        selectFilter: selectFilter,
        modelClass: modelClass,
        relation: relation,
        info: info
      });
    }

    forEachExpr(expr, modelClass, function (childExpr, relation) {
      var nextPath = _this.joinPath(path, relation.name);
      var encNextPath = _this.encode(nextPath);
      var encJoinTablePath = relation.joinTable ? _this.encode(joinTableForPath(nextPath)) : null;

      var filterQuery = createFilterQuery({
        builder: builder,
        relation: relation,
        expr: childExpr
      });

      var relatedJoinSelectQuery = createRelatedJoinFromQuery({
        filterQuery: filterQuery,
        relation: relation,
        allRelations: _this.allRelations
      });

      relation.join(builder, {
        joinOperation: joinOperation,
        ownerTable: info.encPath,
        relatedTableAlias: encNextPath,
        joinTableAlias: encJoinTablePath,
        relatedJoinSelectQuery: relatedJoinSelectQuery
      });

      // Apply relation.modify since it may also contains selections. Don't move this
      // to the createFilterQuery function because relatedJoinSelectQuery is cloned
      // From the return value of that function and we don't want relation.modify
      // to be called twice for it.
      filterQuery.modify(relation.modify);

      _this.doBuild({
        expr: childExpr,
        builder: builder,
        modelClass: relation.relatedModelClass,
        joinOperation: joinOperation,
        relation: relation,
        parentInfo: info,
        noSelects: noSelects,
        path: nextPath,
        selectFilter: function selectFilter(col) {
          return filterQuery.hasSelection(col);
        }
      });
    });
  };

  RelationJoinBuilder.prototype.createPathInfo = function createPathInfo(_ref3) {
    var modelClass = _ref3.modelClass,
        path = _ref3.path,
        relation = _ref3.relation,
        parentInfo = _ref3.parentInfo;

    var encPath = this.encode(path);
    var info = void 0;

    if (relation && relation.isOneToOne()) {
      info = new OneToOnePathInfo();
    } else {
      info = new PathInfo();
    }

    info.path = path;
    info.encPath = encPath;
    info.parentPath = parentInfo && parentInfo.path;
    info.encParentPath = parentInfo && parentInfo.encPath;
    info.modelClass = modelClass;
    info.relation = relation;
    info.idGetter = this.createIdGetter(modelClass, encPath);

    if (parentInfo) {
      parentInfo.children[relation.name] = info;
    }

    return info;
  };

  RelationJoinBuilder.prototype.buildSelects = function buildSelects(_ref4) {
    var _this2 = this;

    var builder = _ref4.builder,
        selectFilter = _ref4.selectFilter,
        modelClass = _ref4.modelClass,
        relation = _ref4.relation,
        info = _ref4.info;

    var selects = [];
    var idCols = modelClass.getIdColumnArray();
    var rootTable = this.rootModelClass.tableName;

    columnInfo[modelClass.tableName].columns.forEach(function (col) {
      var filterPassed = selectFilter(col);
      var isIdColumn = idCols.indexOf(col) !== -1;

      if (filterPassed || isIdColumn) {
        selects.push({
          col: (info.encPath || rootTable) + '.' + col,
          alias: _this2.joinPath(info.encPath, col)
        });

        if (!filterPassed) {
          info.omitCols[col] = true;
        }
      }
    });

    if (relation && relation.joinTableExtras) {
      var joinTable = this.encode(joinTableForPath(info.path));

      relation.joinTableExtras.forEach(function (extra) {
        if (selectFilter(extra.joinTableCol)) {
          selects.push({
            col: joinTable + '.' + extra.joinTableCol,
            alias: _this2.joinPath(info.encPath, extra.aliasCol)
          });
        }
      });
    }

    var tooLongAliases = selects.filter(function (select) {
      return select.alias.length > idLengthLimit;
    });

    if (tooLongAliases.length) {
      throw new _ValidationError2.default({
        eager: 'identifier ' + tooLongAliases[0].alias + ' is over ' + idLengthLimit + ' characters long ' + 'and would be truncated by the database engine.'
      });
    }

    builder.select(selects.filter(function (select) {
      return !builder.hasSelection(select.col, true);
    }).map(function (select) {
      return select.col + ' as ' + select.alias;
    }));
  };

  RelationJoinBuilder.prototype.encode = function encode(path) {
    var _this3 = this;

    if (!this.opt.minimize) {
      var encPath = this.encodings[path];

      if (!encPath) {
        var parts = path.split(this.sep);

        // Don't encode the root.
        if (!path) {
          encPath = path;
        } else {
          encPath = parts.map(function (part) {
            return _this3.opt.aliases[part] || part;
          }).join(this.sep);
        }

        this.encodings[path] = encPath;
        this.decodings[encPath] = path;
      }

      return encPath;
    } else {
      var _encPath = this.encodings[path];

      if (!_encPath) {
        // Don't encode the root.
        if (!path) {
          _encPath = path;
        } else {
          _encPath = this.nextEncodedPath();
        }

        this.encodings[path] = _encPath;
        this.decodings[_encPath] = path;
      }

      return _encPath;
    }
  };

  RelationJoinBuilder.prototype.decode = function decode(path) {
    return this.decodings[path];
  };

  RelationJoinBuilder.prototype.nextEncodedPath = function nextEncodedPath() {
    return '_t' + ++this.encIdx;
  };

  RelationJoinBuilder.prototype.createIdGetter = function createIdGetter(modelClass, path) {
    var _this4 = this;

    var idCols = modelClass.getIdColumnArray().map(function (col) {
      return _this4.joinPath(path, col);
    });

    if (idCols.length === 1) {
      return createSingleIdGetter(idCols);
    } else if (idCols.length === 2) {
      return createTwoIdGetter(idCols);
    } else if (idCols.length === 3) {
      return createThreeIdGetter(idCols);
    } else {
      return createNIdGetter(idCols);
    }
  };

  RelationJoinBuilder.prototype.joinPath = function joinPath(path, nextPart) {
    if (path) {
      return '' + path + this.sep + nextPart;
    } else {
      return nextPart;
    }
  };

  (0, _createClass3.default)(RelationJoinBuilder, [{
    key: 'sep',
    get: function get() {
      return this.opt.separator;
    }
  }]);
  return RelationJoinBuilder;
}();

exports.default = RelationJoinBuilder;


function findAllModels(expr, modelClass) {
  var models = [];

  findAllModelsImpl(expr, modelClass, models);

  return _lodash2.default.uniqBy(models, 'tableName');
}

function findAllModelsImpl(expr, modelClass, models) {
  models.push(modelClass);

  forEachExpr(expr, modelClass, function (childExpr, relation) {
    findAllModelsImpl(childExpr, relation.relatedModelClass, models);
  });
}

function findAllRelations(expr, modelClass) {
  var relations = [];

  findAllRelationsImpl(expr, modelClass, relations);

  return _lodash2.default.uniqWith(relations, function (lhs, rhs) {
    return lhs === rhs;
  });
}

function findAllRelationsImpl(expr, modelClass, relations) {
  forEachExpr(expr, modelClass, function (childExpr, relation) {
    relations.push(relation);

    findAllRelationsImpl(childExpr, relation.relatedModelClass, relations);
  });
}

function forEachExpr(expr, modelClass, callback) {
  var relations = modelClass.getRelationArray();

  if (expr.isAllRecursive() || expr.maxRecursionDepth() > relationRecursionLimit) {
    throw new _ValidationError2.default({
      eager: 'recursion depth of eager expression ' + expr.toString() + ' too big for JoinEagerAlgorithm'
    });
  }

  for (var i = 0, l = relations.length; i < l; ++i) {
    var relation = relations[i];
    var childExpr = expr.childExpression(relation.name);

    if (childExpr) {
      callback(childExpr, relation, relation.name);
    }
  }
}

function createSingleIdGetter(idCols) {
  var idCol = idCols[0];

  return function (row) {
    var val = row[idCol];

    if (!val) {
      return null;
    } else {
      return 'id:' + val;
    }
  };
}

function createTwoIdGetter(idCols) {
  var idCol1 = idCols[0];
  var idCol2 = idCols[1];

  return function (row) {
    var val1 = row[idCol1];
    var val2 = row[idCol2];

    if (!val1 || !val2) {
      return null;
    } else {
      return 'id:' + val1 + ',' + val2;
    }
  };
}

function createThreeIdGetter(idCols) {
  var idCol1 = idCols[0];
  var idCol2 = idCols[1];
  var idCol3 = idCols[2];

  return function (row) {
    var val1 = row[idCol1];
    var val2 = row[idCol2];
    var val3 = row[idCol3];

    if (!val1 || !val2 || !val3) {
      return null;
    } else {
      return 'id:' + val1 + ',' + val2 + ',' + val3;
    }
  };
}

function createNIdGetter(idCols) {
  return function (row) {
    var id = 'id:';

    for (var i = 0, l = idCols.length; i < l; ++i) {
      var val = row[idCols[i]];

      if (!val) {
        return null;
      }

      id += (i > 0 ? ',' : '') + val;
    }

    return id;
  };
}

function createFilterQuery(_ref5) {
  var builder = _ref5.builder,
      expr = _ref5.expr,
      relation = _ref5.relation;

  var filterQuery = relation.relatedModelClass.query().childQueryOf(builder);

  for (var i = 0, l = expr.args.length; i < l; ++i) {
    var filterName = expr.args[i];
    var filter = expr.filters[filterName];

    if (typeof filter !== 'function') {
      throw new _ValidationError2.default({ eager: 'could not find filter "' + filterName + '" for relation "' + relation.name + '"' });
    }

    filter(filterQuery);
  }

  return filterQuery;
}

function createRelatedJoinFromQuery(_ref6) {
  var filterQuery = _ref6.filterQuery,
      relation = _ref6.relation,
      allRelations = _ref6.allRelations;

  var relatedJoinFromQuery = filterQuery.clone();

  var allForeignKeys = findAllForeignKeysForModel({
    modelClass: relation.relatedModelClass,
    allRelations: allRelations
  });

  return relatedJoinFromQuery.select(allForeignKeys.filter(function (col) {
    return !relatedJoinFromQuery.hasSelection(col);
  }));
}

function findAllForeignKeysForModel(_ref7) {
  var modelClass = _ref7.modelClass,
      allRelations = _ref7.allRelations;

  var foreignKeys = modelClass.getIdColumnArray().slice();

  allRelations.forEach(function (rel) {
    if (rel.relatedModelClass.tableName === modelClass.tableName) {
      rel.relatedCol.forEach(function (col) {
        return foreignKeys.push(col);
      });
    }

    if (rel.ownerModelClass.tableName === modelClass.tableName) {
      rel.ownerCol.forEach(function (col) {
        return foreignKeys.push(col);
      });
    }
  });

  return _lodash2.default.uniq(foreignKeys);
}

function createModel(row, pInfo, keyInfoByPath) {
  var keyInfo = keyInfoByPath[pInfo.encPath];
  var json = {};

  for (var k = 0, lk = keyInfo.length; k < lk; ++k) {
    var kInfo = keyInfo[k];
    json[kInfo.col] = row[kInfo.key];
  }

  return pInfo.modelClass.fromDatabaseJson(json);
}

function joinTableForPath(path) {
  return path + '_join';
}

var PathInfo = function () {
  function PathInfo() {
    (0, _classCallCheck3.default)(this, PathInfo);

    this.path = null;
    this.encPath = null;
    this.encParentPath = null;
    this.modelClass = null;
    this.relation = null;
    this.omitCols = (0, _create2.default)(null);
    this.children = (0, _create2.default)(null);
    this.idGetter = null;
  }

  PathInfo.prototype.createBranch = function createBranch(parentModel) {
    var branch = (0, _create2.default)(null);
    parentModel[this.relation.name] = branch;
    return branch;
  };

  PathInfo.prototype.getBranch = function getBranch(parentModel) {
    return parentModel[this.relation.name];
  };

  PathInfo.prototype.getModelFromBranch = function getModelFromBranch(branch, id) {
    return branch[id];
  };

  PathInfo.prototype.setModelToBranch = function setModelToBranch(branch, id, model) {
    branch[id] = model;
  };

  PathInfo.prototype.finalizeBranch = function finalizeBranch(branch, parentModel) {
    var relModels = _lodash2.default.values(branch);
    parentModel[this.relation.name] = relModels;
    return relModels;
  };

  return PathInfo;
}();

var OneToOnePathInfo = function (_PathInfo) {
  (0, _inherits3.default)(OneToOnePathInfo, _PathInfo);

  function OneToOnePathInfo() {
    (0, _classCallCheck3.default)(this, OneToOnePathInfo);
    return (0, _possibleConstructorReturn3.default)(this, _PathInfo.apply(this, arguments));
  }

  OneToOnePathInfo.prototype.createBranch = function createBranch(parentModel) {
    return parentModel;
  };

  OneToOnePathInfo.prototype.getBranch = function getBranch(parentModel) {
    return parentModel;
  };

  OneToOnePathInfo.prototype.getModelFromBranch = function getModelFromBranch(branch, id) {
    return branch[this.relation.name];
  };

  OneToOnePathInfo.prototype.setModelToBranch = function setModelToBranch(branch, id, model) {
    branch[this.relation.name] = model;
  };

  OneToOnePathInfo.prototype.finalizeBranch = function finalizeBranch(branch, parentModel) {
    parentModel[this.relation.name] = branch || null;
    return branch || null;
  };

  return OneToOnePathInfo;
}(PathInfo);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJlbGF0aW9uSm9pbkJ1aWxkZXIuanMiXSwibmFtZXMiOlsiY29sdW1uSW5mbyIsImlkTGVuZ3RoTGltaXQiLCJyZWxhdGlvblJlY3Vyc2lvbkxpbWl0IiwiUmVsYXRpb25Kb2luQnVpbGRlciIsIm1vZGVsQ2xhc3MiLCJleHByZXNzaW9uIiwib3B0Iiwicm9vdE1vZGVsQ2xhc3MiLCJhbGxSZWxhdGlvbnMiLCJwYXRoSW5mbyIsImVuY29kaW5ncyIsImRlY29kaW5ncyIsImVuY0lkeCIsImRlZmF1bHRzIiwibWluaW1pemUiLCJzZXBhcmF0b3IiLCJhbGlhc2VzIiwiY2xvbmUiLCJwcm9wcyIsImNvcHkiLCJmZXRjaENvbHVtbkluZm8iLCJrbmV4IiwiYWxsTW9kZWxDbGFzc2VzIiwiZmluZEFsbE1vZGVscyIsImFsbCIsIm1hcCIsInRhYmxlIiwiTW9kZWxDbGFzcyIsInRhYmxlTmFtZSIsInRoZW4iLCJyZXN1bHQiLCJjb2x1bW5zIiwiaW5mbyIsImJ1aWxkSm9pbk9ubHkiLCJidWlsZGVyIiwiZG9CdWlsZCIsImV4cHIiLCJqb2luT3BlcmF0aW9uIiwicGFyZW50SW5mbyIsInJlbGF0aW9uIiwibm9TZWxlY3RzIiwicGF0aCIsImJ1aWxkIiwiYnVpbGRlckNsb25lIiwiZmluZE9wdGlvbnMiLCJjYWxsQWZ0ZXJHZXREZWVwbHkiLCJzZWxlY3RGaWx0ZXIiLCJjb2wiLCJoYXNTZWxlY3Rpb24iLCJyb3dzVG9UcmVlIiwicm93cyIsImlzRW1wdHkiLCJrZXlJbmZvQnlQYXRoIiwiY3JlYXRlS2V5SW5mbyIsInZhbHVlcyIsInRyZWUiLCJzdGFjayIsImkiLCJsciIsImxlbmd0aCIsInJvdyIsImN1ckJyYW5jaCIsImoiLCJscCIsInBJbmZvIiwiaWQiLCJpZEdldHRlciIsInBhcmVudE1vZGVsIiwiZW5jUGFyZW50UGF0aCIsImdldEJyYW5jaCIsImNyZWF0ZUJyYW5jaCIsIm1vZGVsIiwiZ2V0TW9kZWxGcm9tQnJhbmNoIiwiY3JlYXRlTW9kZWwiLCJzZXRNb2RlbFRvQnJhbmNoIiwiZW5jUGF0aCIsImZpbmFsaXplIiwia2V5cyIsImtleUluZm8iLCJsIiwia2V5Iiwic2VwSWR4IiwibGFzdEluZGV4T2YiLCJzZXAiLCJvbWl0Q29scyIsInB1c2giLCJzdWJzdHIiLCJkZWNvZGUiLCJncm91cEJ5Iiwia0luZm8iLCJtb2RlbHMiLCJyZWxOYW1lcyIsImNoaWxkcmVuIiwiQXJyYXkiLCJpc0FycmF5IiwibSIsImxtIiwiZmluYWxpemVPbmUiLCJyIiwicmVsTmFtZSIsImJyYW5jaCIsImNoaWxkUGF0aEluZm8iLCJmaW5hbGl6ZWQiLCJmaW5hbGl6ZUJyYW5jaCIsImZpbmRBbGxSZWxhdGlvbnMiLCJjcmVhdGVQYXRoSW5mbyIsImJ1aWxkU2VsZWN0cyIsImZvckVhY2hFeHByIiwiY2hpbGRFeHByIiwibmV4dFBhdGgiLCJqb2luUGF0aCIsIm5hbWUiLCJlbmNOZXh0UGF0aCIsImVuY29kZSIsImVuY0pvaW5UYWJsZVBhdGgiLCJqb2luVGFibGUiLCJqb2luVGFibGVGb3JQYXRoIiwiZmlsdGVyUXVlcnkiLCJjcmVhdGVGaWx0ZXJRdWVyeSIsInJlbGF0ZWRKb2luU2VsZWN0UXVlcnkiLCJjcmVhdGVSZWxhdGVkSm9pbkZyb21RdWVyeSIsImpvaW4iLCJvd25lclRhYmxlIiwicmVsYXRlZFRhYmxlQWxpYXMiLCJqb2luVGFibGVBbGlhcyIsIm1vZGlmeSIsInJlbGF0ZWRNb2RlbENsYXNzIiwiaXNPbmVUb09uZSIsIk9uZVRvT25lUGF0aEluZm8iLCJQYXRoSW5mbyIsInBhcmVudFBhdGgiLCJjcmVhdGVJZEdldHRlciIsInNlbGVjdHMiLCJpZENvbHMiLCJnZXRJZENvbHVtbkFycmF5Iiwicm9vdFRhYmxlIiwiZm9yRWFjaCIsImZpbHRlclBhc3NlZCIsImlzSWRDb2x1bW4iLCJpbmRleE9mIiwiYWxpYXMiLCJqb2luVGFibGVFeHRyYXMiLCJleHRyYSIsImpvaW5UYWJsZUNvbCIsImFsaWFzQ29sIiwidG9vTG9uZ0FsaWFzZXMiLCJmaWx0ZXIiLCJzZWxlY3QiLCJlYWdlciIsInBhcnRzIiwic3BsaXQiLCJwYXJ0IiwibmV4dEVuY29kZWRQYXRoIiwiY3JlYXRlU2luZ2xlSWRHZXR0ZXIiLCJjcmVhdGVUd29JZEdldHRlciIsImNyZWF0ZVRocmVlSWRHZXR0ZXIiLCJjcmVhdGVOSWRHZXR0ZXIiLCJuZXh0UGFydCIsImZpbmRBbGxNb2RlbHNJbXBsIiwidW5pcUJ5IiwicmVsYXRpb25zIiwiZmluZEFsbFJlbGF0aW9uc0ltcGwiLCJ1bmlxV2l0aCIsImxocyIsInJocyIsImNhbGxiYWNrIiwiZ2V0UmVsYXRpb25BcnJheSIsImlzQWxsUmVjdXJzaXZlIiwibWF4UmVjdXJzaW9uRGVwdGgiLCJ0b1N0cmluZyIsImNoaWxkRXhwcmVzc2lvbiIsImlkQ29sIiwidmFsIiwiaWRDb2wxIiwiaWRDb2wyIiwidmFsMSIsInZhbDIiLCJpZENvbDMiLCJ2YWwzIiwicXVlcnkiLCJjaGlsZFF1ZXJ5T2YiLCJhcmdzIiwiZmlsdGVyTmFtZSIsImZpbHRlcnMiLCJyZWxhdGVkSm9pbkZyb21RdWVyeSIsImFsbEZvcmVpZ25LZXlzIiwiZmluZEFsbEZvcmVpZ25LZXlzRm9yTW9kZWwiLCJmb3JlaWduS2V5cyIsInNsaWNlIiwicmVsIiwicmVsYXRlZENvbCIsIm93bmVyTW9kZWxDbGFzcyIsIm93bmVyQ29sIiwidW5pcSIsImpzb24iLCJrIiwibGsiLCJmcm9tRGF0YWJhc2VKc29uIiwicmVsTW9kZWxzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7QUFFQSxJQUFNQSxhQUFhLHNCQUFjLElBQWQsQ0FBbkI7QUFDQSxJQUFNQyxnQkFBZ0IsRUFBdEI7QUFDQSxJQUFNQyx5QkFBeUIsRUFBL0I7O0lBRXFCQyxtQjtBQUVuQixxQ0FBMkM7QUFBQSxRQUE5QkMsVUFBOEIsUUFBOUJBLFVBQThCO0FBQUEsUUFBbEJDLFVBQWtCLFFBQWxCQSxVQUFrQjtBQUFBLFFBQU5DLEdBQU0sUUFBTkEs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SzdELFFBQUwsQ0FBY3dFLElBQXJCLENBQVA7QUFDRCxHOzs2QkFFRHJDLGdCLDZCQUFpQjBCLE0sRUFBUW5DLEUsRUFBSU0sSyxFQUFPO0FBQ2xDNkIsV0FBTyxLQUFLN0QsUUFBTCxDQUFjd0UsSUFBckIsSUFBNkJ4QyxLQUE3QjtBQUNELEc7OzZCQUdEZ0MsYywyQkFBZUgsTSxFQUFRakMsVyxFQUFhO0FBQ2xDQSxnQkFBWSxLQUFLNUIsUUFBTCxDQUFjd0UsSUFBMUIsSUFBa0NYLFVBQVUsSUFBNUM7QUFDQSxXQUFPQSxVQUFVLElBQWpCO0FBQ0QsRzs7O0VBdEI0QjZCLFEiLCJmaWxlIjoiUmVsYXRpb25Kb2luQnVpbGRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgUHJvbWlzZSBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgVmFsaWRhdGlvbkVycm9yIGZyb20gJy4uLy4uLy4uL21vZGVsL1ZhbGlkYXRpb25FcnJvcic7XG5cbmNvbnN0IGNvbHVtbkluZm8gPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuY29uc3QgaWRMZW5ndGhMaW1pdCA9IDYzO1xuY29uc3QgcmVsYXRpb25SZWN1cnNpb25MaW1pdCA9IDY0O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZWxhdGlvbkpvaW5CdWlsZGVyIHtcblxuICBjb25zdHJ1Y3Rvcih7bW9kZWxDbGFzcywgZXhwcmVzc2lvbiwgb3B0fSkge1xuICAgIHRoaXMucm9vdE1vZGVsQ2xhc3MgPSBtb2RlbENsYXNzO1xuICAgIHRoaXMuZXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG4gICAgdGhpcy5hbGxSZWxhdGlvbnMgPSBudWxsO1xuXG4gICAgdGhpcy5wYXRoSW5mbyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgdGhpcy5lbmNvZGluZ3MgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIHRoaXMuZGVjb2RpbmdzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmVuY0lkeCA9IDA7XG5cbiAgICB0aGlzLm9wdCA9IF8uZGVmYXVsdHMob3B0LCB7XG4gICAgICBtaW5pbWl6ZTogZmFsc2UsXG4gICAgICBzZXBhcmF0b3I6ICc6JyxcbiAgICAgIGFsaWFzZXM6IHt9XG4gICAgfSk7XG4gIH1cblxuICBjbG9uZShwcm9wcykge1xuICAgIHByb3BzID0gcHJvcHMgfHwge307XG5cbiAgICBjb25zdCBjb3B5ID0gbmV3IFJlbGF0aW9uSm9pbkJ1aWxkZXIoe1xuICAgICAgbW9kZWxDbGFzczogdGhpcy5yb290TW9kZWxDbGFzcyxcbiAgICAgIGV4cHJlc3Npb246IHByb3BzLmV4cHJlc3Npb24gfHwgdGhpcy5leHByZXNzaW9uLFxuICAgICAgb3B0OiBwcm9wcy5vcHQgfHwgdGhpcy5vcHRcbiAgICB9KTtcblxuICAgIGNvcHkuYWxsUmVsYXRpb25zID0gdGhpcy5hbGxSZWxhdGlvbnM7XG4gICAgY29weS5wYXRoSW5mbyA9IHRoaXMucGF0aEluZm87XG4gICAgY29weS5lbmNvZGluZ3MgPSB0aGlzLmVuY29kaW5ncztcbiAgICBjb3B5LmRlY29kaW5ncyA9IHRoaXMuZGVjb2RpbmdzO1xuICAgIGNvcHkuZW5jSWR4ID0gdGhpcy5lbmNJZHg7XG5cbiAgICByZXR1cm4gY29weTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaGVzIHRoZSBjb2x1bW4gaW5mb3JtYXRpb24gbmVlZGVkIGZvciBidWlsZGluZyB0aGUgc2VsZWN0IGNsYXVzZXMuXG4gICAqIFRoaXMgbXVzdCBiZSBjYWxsZWQgYmVmb3JlIGNhbGxpbmcgYGJ1aWxkYC4gYGJ1aWxkSm9pbk9ubHlgIGNhbiBiZSBjYWxsZWRcbiAgICogd2l0aG91dCB0aGlzIHNpbmNlIGl0IGRvZXNuJ3QgYnVpbGQgam9pbnMuXG4gICAqL1xuICBmZXRjaENvbHVtbkluZm8oa25leCkge1xuICAgIGNvbnN0IGFsbE1vZGVsQ2xhc3NlcyA9IGZpbmRBbGxNb2RlbHModGhpcy5leHByZXNzaW9uLCB0aGlzLnJvb3RNb2RlbENsYXNzKTtcblxuICAgIHJldHVybiBQcm9taXNlLmFsbChhbGxNb2RlbENsYXNzZXMubWFwKE1vZGVsQ2xhc3MgPT4ge1xuICAgICAgY29uc3QgdGFibGUgPSBNb2RlbENsYXNzLnRhYmxlTmFtZTtcblxuICAgICAgaWYgKGNvbHVtbkluZm9bdGFibGVdKSB7XG4gICAgICAgIHJldHVybiBjb2x1bW5JbmZvW3RhYmxlXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbHVtbkluZm9bdGFibGVdID0ga25leCh0YWJsZSkuY29sdW1uSW5mbygpLnRoZW4oaW5mbyA9PiB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICAgICAgY29sdW1uczogT2JqZWN0LmtleXMoaW5mbylcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY29sdW1uSW5mb1t0YWJsZV0gPSByZXN1bHQ7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGNvbHVtbkluZm9bdGFibGVdO1xuICAgICAgfVxuICAgIH0pKTtcbiAgfVxuXG4gIGJ1aWxkSm9pbk9ubHkoYnVpbGRlcikge1xuICAgIHRoaXMuZG9CdWlsZCh7XG4gICAgICBleHByOiB0aGlzLmV4cHJlc3Npb24sXG4gICAgICBidWlsZGVyOiBidWlsZGVyLFxuICAgICAgbW9kZWxDbGFzczogYnVpbGRlci5tb2RlbENsYXNzKCksXG4gICAgICBqb2luT3BlcmF0aW9uOiB0aGlzLm9wdC5qb2luT3BlcmF0aW9uIHx8ICdsZWZ0Sm9pbicsXG4gICAgICBwYXJlbnRJbmZvOiBudWxsLFxuICAgICAgcmVsYXRpb246IG51bGwsXG4gICAgICBub1NlbGVjdHM6IHRydWUsXG4gICAgICBwYXRoOiAnJyxcbiAgICB9KTtcbiAgfVxuXG4gIGJ1aWxkKGJ1aWxkZXIpIHtcbiAgICBjb25zdCBidWlsZGVyQ2xvbmUgPSBidWlsZGVyLmNsb25lKCk7XG5cbiAgICBidWlsZGVyLnRhYmxlKGAke3RoaXMucm9vdE1vZGVsQ2xhc3MudGFibGVOYW1lfSBhcyAke3RoaXMucm9vdE1vZGVsQ2xhc3MudGFibGVOYW1lfWApO1xuICAgIGJ1aWxkZXIuZmluZE9wdGlvbnMoe2NhbGxBZnRlckdldERlZXBseTogdHJ1ZX0pO1xuXG4gICAgdGhpcy5kb0J1aWxkKHtcbiAgICAgIGV4cHI6IHRoaXMuZXhwcmVzc2lvbixcbiAgICAgIGJ1aWxkZXI6IGJ1aWxkZXIsXG4gICAgICBtb2RlbENsYXNzOiBidWlsZGVyLm1vZGVsQ2xhc3MoKSxcbiAgICAgIGpvaW5PcGVyYXRpb246IHRoaXMub3B0LmpvaW5PcGVyYXRpb24gfHwgJ2xlZnRKb2luJyxcbiAgICAgIHBhcmVudEluZm86IG51bGwsXG4gICAgICByZWxhdGlvbjogbnVsbCxcbiAgICAgIHBhdGg6ICcnLFxuICAgICAgc2VsZWN0RmlsdGVyOiAoY29sKSA9PiB7XG4gICAgICAgIHJldHVybiBidWlsZGVyQ2xvbmUuaGFzU2VsZWN0aW9uKGNvbCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByb3dzVG9UcmVlKHJvd3MpIHtcbiAgICBpZiAoXy5pc0VtcHR5KHJvd3MpKSB7XG4gICAgICByZXR1cm4gcm93cztcbiAgICB9XG5cbiAgICBjb25zdCBrZXlJbmZvQnlQYXRoID0gdGhpcy5jcmVhdGVLZXlJbmZvKHJvd3MpO1xuICAgIGNvbnN0IHBhdGhJbmZvID0gXy52YWx1ZXModGhpcy5wYXRoSW5mbyk7XG5cbiAgICBjb25zdCB0cmVlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICBjb25zdCBzdGFjayA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbiAgICBmb3IgKGxldCBpID0gMCwgbHIgPSByb3dzLmxlbmd0aDsgaSA8IGxyOyArK2kpIHtcbiAgICAgIGNvbnN0IHJvdyA9IHJvd3NbaV07XG4gICAgICBsZXQgY3VyQnJhbmNoID0gdHJlZTtcblxuICAgICAgZm9yIChsZXQgaiA9IDAsIGxwID0gcGF0aEluZm8ubGVuZ3RoOyBqIDwgbHA7ICsraikge1xuICAgICAgICBjb25zdCBwSW5mbyA9IHBhdGhJbmZvW2pdO1xuICAgICAgICBjb25zdCBpZCA9IHBJbmZvLmlkR2V0dGVyKHJvdyk7XG5cbiAgICAgICAgaWYgKCFpZCkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBJbmZvLnJlbGF0aW9uKSB7XG4gICAgICAgICAgY29uc3QgcGFyZW50TW9kZWwgPSBzdGFja1twSW5mby5lbmNQYXJlbnRQYXRoXTtcblxuICAgICAgICAgIGN1ckJyYW5jaCA9IHBJbmZvLmdldEJyYW5jaChwYXJlbnRNb2RlbCk7XG5cbiAgICAgICAgICBpZiAoIWN1ckJyYW5jaCkge1xuICAgICAgICAgICAgY3VyQnJhbmNoID0gcEluZm8uY3JlYXRlQnJhbmNoKHBhcmVudE1vZGVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbW9kZWwgPSBwSW5mby5nZXRNb2RlbEZyb21CcmFuY2goY3VyQnJhbmNoLCBpZCk7XG5cbiAgICAgICAgaWYgKCFtb2RlbCkge1xuICAgICAgICAgIG1vZGVsID0gY3JlYXRlTW9kZWwocm93LCBwSW5mbywga2V5SW5mb0J5UGF0aCk7XG4gICAgICAgICAgcEluZm8uc2V0TW9kZWxUb0JyYW5jaChjdXJCcmFuY2gsIGlkLCBtb2RlbCk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGFja1twSW5mby5lbmNQYXRoXSA9IG1vZGVsO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmZpbmFsaXplKHBhdGhJbmZvWzBdLCBfLnZhbHVlcyh0cmVlKSk7XG4gIH1cblxuICBjcmVhdGVLZXlJbmZvKHJvd3MpIHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMocm93c1swXSk7XG4gICAgY29uc3Qga2V5SW5mbyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSBrZXlzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgY29uc3Qga2V5ID0ga2V5c1tpXTtcbiAgICAgIGNvbnN0IHNlcElkeCA9IGtleS5sYXN0SW5kZXhPZih0aGlzLnNlcCk7XG5cbiAgICAgIGlmIChzZXBJZHggPT09IC0xKSB7XG4gICAgICAgIGNvbnN0IHBJbmZvID0gdGhpcy5wYXRoSW5mb1snJ107XG4gICAgICAgIGNvbnN0IGNvbCA9IGtleTtcblxuICAgICAgICBpZiAoIXBJbmZvLm9taXRDb2xzW2NvbF0pIHtcbiAgICAgICAgICBrZXlJbmZvLnB1c2goe1xuICAgICAgICAgICAgcEluZm86IHBJbmZvLFxuICAgICAgICAgICAga2V5OiBrZXksXG4gICAgICAgICAgICBjb2w6IGNvbFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlbmNQYXRoID0ga2V5LnN1YnN0cigwLCBzZXBJZHgpO1xuICAgICAgICBjb25zdCBwYXRoID0gdGhpcy5kZWNvZGUoZW5jUGF0aCk7XG4gICAgICAgIGNvbnN0IGNvbCA9IGtleS5zdWJzdHIoc2VwSWR4ICsgMSk7XG4gICAgICAgIGNvbnN0IHBJbmZvID0gdGhpcy5wYXRoSW5mb1twYXRoXTtcblxuICAgICAgICBpZiAoIXBJbmZvLm9taXRDb2xzW2NvbF0pIHtcbiAgICAgICAgICBrZXlJbmZvLnB1c2goe1xuICAgICAgICAgICAgcEluZm86IHBJbmZvLFxuICAgICAgICAgICAga2V5OiBrZXksXG4gICAgICAgICAgICBjb2w6IGNvbFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIF8uZ3JvdXBCeShrZXlJbmZvLCBrSW5mbyA9PiBrSW5mby5wSW5mby5lbmNQYXRoKTtcbiAgfVxuXG4gIGZpbmFsaXplKHBJbmZvLCBtb2RlbHMpIHtcbiAgICBjb25zdCByZWxOYW1lcyA9IE9iamVjdC5rZXlzKHBJbmZvLmNoaWxkcmVuKTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KG1vZGVscykpIHtcbiAgICAgIGZvciAobGV0IG0gPSAwLCBsbSA9IG1vZGVscy5sZW5ndGg7IG0gPCBsbTsgKyttKSB7XG4gICAgICAgIHRoaXMuZmluYWxpemVPbmUocEluZm8sIHJlbE5hbWVzLCBtb2RlbHNbbV0pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobW9kZWxzKSB7XG4gICAgICB0aGlzLmZpbmFsaXplT25lKHBJbmZvLCByZWxOYW1lcywgbW9kZWxzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbW9kZWxzO1xuICB9XG5cbiAgZmluYWxpemVPbmUocEluZm8sIHJlbE5hbWVzLCBtb2RlbCkge1xuICAgIGZvciAobGV0IHIgPSAwLCBsciA9IHJlbE5hbWVzLmxlbmd0aDsgciA8IGxyOyArK3IpIHtcbiAgICAgIGNvbnN0IHJlbE5hbWUgPSByZWxOYW1lc1tyXTtcbiAgICAgIGNvbnN0IGJyYW5jaCA9IG1vZGVsW3JlbE5hbWVdO1xuICAgICAgY29uc3QgY2hpbGRQYXRoSW5mbyA9IHBJbmZvLmNoaWxkcmVuW3JlbE5hbWVdO1xuXG4gICAgICBjb25zdCBmaW5hbGl6ZWQgPSBjaGlsZFBhdGhJbmZvLmZpbmFsaXplQnJhbmNoKGJyYW5jaCwgbW9kZWwpO1xuICAgICAgdGhpcy5maW5hbGl6ZShjaGlsZFBhdGhJbmZvLCBmaW5hbGl6ZWQpO1xuICAgIH1cbiAgfVxuXG4gIGRvQnVpbGQoe2V4cHIsIGJ1aWxkZXIsIHNlbGVjdEZpbHRlciwgbW9kZWxDbGFzcywgcmVsYXRpb24sIHBhdGgsIHBhcmVudEluZm8sIGpvaW5PcGVyYXRpb24sIG5vU2VsZWN0c30pIHtcbiAgICBpZiAoIXRoaXMuYWxsUmVsYXRpb25zKSB7XG4gICAgICB0aGlzLmFsbFJlbGF0aW9ucyA9IGZpbmRBbGxSZWxhdGlvbnModGhpcy5leHByZXNzaW9uLCB0aGlzLnJvb3RNb2RlbENsYXNzKTtcbiAgICB9XG5cbiAgICBjb25zdCBpbmZvID0gdGhpcy5jcmVhdGVQYXRoSW5mbyh7XG4gICAgICBtb2RlbENsYXNzLFxuICAgICAgcGF0aCxcbiAgICAgIHJlbGF0aW9uLFxuICAgICAgcGFyZW50SW5mb1xuICAgIH0pO1xuXG4gICAgdGhpcy5wYXRoSW5mb1twYXRoXSA9IGluZm87XG5cbiAgICBpZiAoIW5vU2VsZWN0cykge1xuICAgICAgdGhpcy5idWlsZFNlbGVjdHMoe1xuICAgICAgICBidWlsZGVyLFxuICAgICAgICBzZWxlY3RGaWx0ZXIsXG4gICAgICAgIG1vZGVsQ2xhc3MsXG4gICAgICAgIHJlbGF0aW9uLFxuICAgICAgICBpbmZvXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmb3JFYWNoRXhwcihleHByLCBtb2RlbENsYXNzLCAoY2hpbGRFeHByLCByZWxhdGlvbikgPT4ge1xuICAgICAgY29uc3QgbmV4dFBhdGggPSB0aGlzLmpvaW5QYXRoKHBhdGgsIHJlbGF0aW9uLm5hbWUpO1xuICAgICAgY29uc3QgZW5jTmV4dFBhdGggPSB0aGlzLmVuY29kZShuZXh0UGF0aCk7XG4gICAgICBjb25zdCBlbmNKb2luVGFibGVQYXRoID0gcmVsYXRpb24uam9pblRhYmxlXG4gICAgICAgID8gdGhpcy5lbmNvZGUoam9pblRhYmxlRm9yUGF0aChuZXh0UGF0aCkpXG4gICAgICAgIDogbnVsbDtcblxuICAgICAgY29uc3QgZmlsdGVyUXVlcnkgPSBjcmVhdGVGaWx0ZXJRdWVyeSh7XG4gICAgICAgIGJ1aWxkZXIsXG4gICAgICAgIHJlbGF0aW9uLFxuICAgICAgICBleHByOiBjaGlsZEV4cHJcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZWxhdGVkSm9pblNlbGVjdFF1ZXJ5ID0gY3JlYXRlUmVsYXRlZEpvaW5Gcm9tUXVlcnkoe1xuICAgICAgICBmaWx0ZXJRdWVyeSxcbiAgICAgICAgcmVsYXRpb24sXG4gICAgICAgIGFsbFJlbGF0aW9uczogdGhpcy5hbGxSZWxhdGlvbnNcbiAgICAgIH0pO1xuXG4gICAgICByZWxhdGlvbi5qb2luKGJ1aWxkZXIsIHtcbiAgICAgICAgam9pbk9wZXJhdGlvbixcbiAgICAgICAgb3duZXJUYWJsZTogaW5mby5lbmNQYXRoLFxuICAgICAgICByZWxhdGVkVGFibGVBbGlhczogZW5jTmV4dFBhdGgsXG4gICAgICAgIGpvaW5UYWJsZUFsaWFzOiBlbmNKb2luVGFibGVQYXRoLFxuICAgICAgICByZWxhdGVkSm9pblNlbGVjdFF1ZXJ5OiByZWxhdGVkSm9pblNlbGVjdFF1ZXJ5XG4gICAgICB9KTtcblxuICAgICAgLy8gQXBwbHkgcmVsYXRpb24ubW9kaWZ5IHNpbmNlIGl0IG1heSBhbHNvIGNvbnRhaW5zIHNlbGVjdGlvbnMuIERvbid0IG1vdmUgdGhpc1xuICAgICAgLy8gdG8gdGhlIGNyZWF0ZUZpbHRlclF1ZXJ5IGZ1bmN0aW9uIGJlY2F1c2UgcmVsYXRlZEpvaW5TZWxlY3RRdWVyeSBpcyBjbG9uZWRcbiAgICAgIC8vIEZyb20gdGhlIHJldHVybiB2YWx1ZSBvZiB0aGF0IGZ1bmN0aW9uIGFuZCB3ZSBkb24ndCB3YW50IHJlbGF0aW9uLm1vZGlmeVxuICAgICAgLy8gdG8gYmUgY2FsbGVkIHR3aWNlIGZvciBpdC5cbiAgICAgIGZpbHRlclF1ZXJ5Lm1vZGlmeShyZWxhdGlvbi5tb2RpZnkpO1xuXG4gICAgICB0aGlzLmRvQnVpbGQoe1xuICAgICAgICBleHByOiBjaGlsZEV4cHIsXG4gICAgICAgIGJ1aWxkZXI6IGJ1aWxkZXIsXG4gICAgICAgIG1vZGVsQ2xhc3M6IHJlbGF0aW9uLnJlbGF0ZWRNb2RlbENsYXNzLFxuICAgICAgICBqb2luT3BlcmF0aW9uOiBqb2luT3BlcmF0aW9uLFxuICAgICAgICByZWxhdGlvbjogcmVsYXRpb24sXG4gICAgICAgIHBhcmVudEluZm86IGluZm8sXG4gICAgICAgIG5vU2VsZWN0czogbm9TZWxlY3RzLFxuICAgICAgICBwYXRoOiBuZXh0UGF0aCxcbiAgICAgICAgc2VsZWN0RmlsdGVyOiAoY29sKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGZpbHRlclF1ZXJ5Lmhhc1NlbGVjdGlvbihjb2wpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGNyZWF0ZVBhdGhJbmZvKHttb2RlbENsYXNzLCBwYXRoLCByZWxhdGlvbiwgcGFyZW50SW5mb30pIHtcbiAgICBjb25zdCBlbmNQYXRoID0gdGhpcy5lbmNvZGUocGF0aCk7XG4gICAgbGV0IGluZm87XG5cbiAgICBpZiAocmVsYXRpb24gJiYgcmVsYXRpb24uaXNPbmVUb09uZSgpKSB7XG4gICAgICBpbmZvID0gbmV3IE9uZVRvT25lUGF0aEluZm8oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaW5mbyA9IG5ldyBQYXRoSW5mbygpO1xuICAgIH1cblxuICAgIGluZm8ucGF0aCA9IHBhdGg7XG4gICAgaW5mby5lbmNQYXRoID0gZW5jUGF0aDtcbiAgICBpbmZvLnBhcmVudFBhdGggPSBwYXJlbnRJbmZvICYmIHBhcmVudEluZm8ucGF0aDtcbiAgICBpbmZvLmVuY1BhcmVudFBhdGggPSBwYXJlbnRJbmZvICYmIHBhcmVudEluZm8uZW5jUGF0aDtcbiAgICBpbmZvLm1vZGVsQ2xhc3MgPSBtb2RlbENsYXNzO1xuICAgIGluZm8ucmVsYXRpb24gPSByZWxhdGlvbjtcbiAgICBpbmZvLmlkR2V0dGVyID0gdGhpcy5jcmVhdGVJZEdldHRlcihtb2RlbENsYXNzLCBlbmNQYXRoKTtcblxuICAgIGlmIChwYXJlbnRJbmZvKSB7XG4gICAgICBwYXJlbnRJbmZvLmNoaWxkcmVuW3JlbGF0aW9uLm5hbWVdID0gaW5mbztcbiAgICB9XG5cbiAgICByZXR1cm4gaW5mbztcbiAgfVxuXG4gIGJ1aWxkU2VsZWN0cyh7YnVpbGRlciwgc2VsZWN0RmlsdGVyLCBtb2RlbENsYXNzLCByZWxhdGlvbiwgaW5mb30pIHtcbiAgICBjb25zdCBzZWxlY3RzID0gW107XG4gICAgY29uc3QgaWRDb2xzID0gbW9kZWxDbGFzcy5nZXRJZENvbHVtbkFycmF5KCk7XG4gICAgY29uc3Qgcm9vdFRhYmxlID0gdGhpcy5yb290TW9kZWxDbGFzcy50YWJsZU5hbWU7XG5cbiAgICBjb2x1bW5JbmZvW21vZGVsQ2xhc3MudGFibGVOYW1lXS5jb2x1bW5zLmZvckVhY2goY29sID0+IHtcbiAgICAgIGNvbnN0IGZpbHRlclBhc3NlZCA9IHNlbGVjdEZpbHRlcihjb2wpO1xuICAgICAgY29uc3QgaXNJZENvbHVtbiA9IGlkQ29scy5pbmRleE9mKGNvbCkgIT09IC0xO1xuXG4gICAgICBpZiAoZmlsdGVyUGFzc2VkIHx8IGlzSWRDb2x1bW4pIHtcbiAgICAgICAgc2VsZWN0cy5wdXNoKHtcbiAgICAgICAgICBjb2w6IGAke2luZm8uZW5jUGF0aCB8fCByb290VGFibGV9LiR7Y29sfWAsXG4gICAgICAgICAgYWxpYXM6IHRoaXMuam9pblBhdGgoaW5mby5lbmNQYXRoLCBjb2wpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghZmlsdGVyUGFzc2VkKSB7XG4gICAgICAgICAgaW5mby5vbWl0Q29sc1tjb2xdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKHJlbGF0aW9uICYmIHJlbGF0aW9uLmpvaW5UYWJsZUV4dHJhcykge1xuICAgICAgY29uc3Qgam9pblRhYmxlID0gdGhpcy5lbmNvZGUoam9pblRhYmxlRm9yUGF0aChpbmZvLnBhdGgpKTtcblxuICAgICAgcmVsYXRpb24uam9pblRhYmxlRXh0cmFzLmZvckVhY2goZXh0cmEgPT4ge1xuICAgICAgICBpZiAoc2VsZWN0RmlsdGVyKGV4dHJhLmpvaW5UYWJsZUNvbCkpIHtcbiAgICAgICAgICBzZWxlY3RzLnB1c2goe1xuICAgICAgICAgICAgY29sOiBgJHtqb2luVGFibGV9LiR7ZXh0cmEuam9pblRhYmxlQ29sfWAsXG4gICAgICAgICAgICBhbGlhczogdGhpcy5qb2luUGF0aChpbmZvLmVuY1BhdGgsIGV4dHJhLmFsaWFzQ29sKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB0b29Mb25nQWxpYXNlcyA9IHNlbGVjdHMuZmlsdGVyKHNlbGVjdCA9PiBzZWxlY3QuYWxpYXMubGVuZ3RoID4gaWRMZW5ndGhMaW1pdCk7XG5cbiAgICBpZiAodG9vTG9uZ0FsaWFzZXMubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKHtcbiAgICAgICAgZWFnZXI6IGBpZGVudGlmaWVyICR7dG9vTG9uZ0FsaWFzZXNbMF0uYWxpYXN9IGlzIG92ZXIgJHtpZExlbmd0aExpbWl0fSBjaGFyYWN0ZXJzIGxvbmcgYFxuICAgICAgICArIGBhbmQgd291bGQgYmUgdHJ1bmNhdGVkIGJ5IHRoZSBkYXRhYmFzZSBlbmdpbmUuYFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgYnVpbGRlci5zZWxlY3Qoc2VsZWN0c1xuICAgICAgLmZpbHRlcihzZWxlY3QgPT4gIWJ1aWxkZXIuaGFzU2VsZWN0aW9uKHNlbGVjdC5jb2wsIHRydWUpKVxuICAgICAgLm1hcChzZWxlY3QgPT4gYCR7c2VsZWN0LmNvbH0gYXMgJHtzZWxlY3QuYWxpYXN9YClcbiAgICApO1xuICB9XG5cbiAgZW5jb2RlKHBhdGgpIHtcbiAgICBpZiAoIXRoaXMub3B0Lm1pbmltaXplKSB7XG4gICAgICBsZXQgZW5jUGF0aCA9IHRoaXMuZW5jb2RpbmdzW3BhdGhdO1xuXG4gICAgICBpZiAoIWVuY1BhdGgpIHtcbiAgICAgICAgY29uc3QgcGFydHMgPSBwYXRoLnNwbGl0KHRoaXMuc2VwKTtcblxuICAgICAgICAvLyBEb24ndCBlbmNvZGUgdGhlIHJvb3QuXG4gICAgICAgIGlmICghcGF0aCkge1xuICAgICAgICAgIGVuY1BhdGggPSBwYXRoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVuY1BhdGggPSBwYXJ0cy5tYXAocGFydCA9PiB0aGlzLm9wdC5hbGlhc2VzW3BhcnRdIHx8IHBhcnQpLmpvaW4odGhpcy5zZXApO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5lbmNvZGluZ3NbcGF0aF0gPSBlbmNQYXRoO1xuICAgICAgICB0aGlzLmRlY29kaW5nc1tlbmNQYXRoXSA9IHBhdGg7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBlbmNQYXRoO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgZW5jUGF0aCA9IHRoaXMuZW5jb2RpbmdzW3BhdGhdO1xuXG4gICAgICBpZiAoIWVuY1BhdGgpIHtcbiAgICAgICAgLy8gRG9uJ3QgZW5jb2RlIHRoZSByb290LlxuICAgICAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgICBlbmNQYXRoID0gcGF0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbmNQYXRoID0gdGhpcy5uZXh0RW5jb2RlZFBhdGgoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZW5jb2RpbmdzW3BhdGhdID0gZW5jUGF0aDtcbiAgICAgICAgdGhpcy5kZWNvZGluZ3NbZW5jUGF0aF0gPSBwYXRoO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZW5jUGF0aDtcbiAgICB9XG4gIH1cblxuICBkZWNvZGUocGF0aCkge1xuICAgIHJldHVybiB0aGlzLmRlY29kaW5nc1twYXRoXTtcbiAgfVxuXG4gIG5leHRFbmNvZGVkUGF0aCgpIHtcbiAgICByZXR1cm4gYF90JHsrK3RoaXMuZW5jSWR4fWA7XG4gIH1cblxuICBjcmVhdGVJZEdldHRlcihtb2RlbENsYXNzLCBwYXRoKSB7XG4gICAgY29uc3QgaWRDb2xzID0gbW9kZWxDbGFzcy5nZXRJZENvbHVtbkFycmF5KCkubWFwKGNvbCA9PiB0aGlzLmpvaW5QYXRoKHBhdGgsIGNvbCkpO1xuXG4gICAgaWYgKGlkQ29scy5sZW5ndGggPT09IDEpIHtcbiAgICAgIHJldHVybiBjcmVhdGVTaW5nbGVJZEdldHRlcihpZENvbHMpO1xuICAgIH0gZWxzZSBpZiAoaWRDb2xzLmxlbmd0aCA9PT0gMikge1xuICAgICAgcmV0dXJuIGNyZWF0ZVR3b0lkR2V0dGVyKGlkQ29scyk7XG4gICAgfSBlbHNlIGlmIChpZENvbHMubGVuZ3RoID09PSAzKSB7XG4gICAgICByZXR1cm4gY3JlYXRlVGhyZWVJZEdldHRlcihpZENvbHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY3JlYXRlTklkR2V0dGVyKGlkQ29scyk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IHNlcCgpIHtcbiAgICByZXR1cm4gdGhpcy5vcHQuc2VwYXJhdG9yO1xuICB9XG5cbiAgam9pblBhdGgocGF0aCwgbmV4dFBhcnQpIHtcbiAgICBpZiAocGF0aCkge1xuICAgICAgcmV0dXJuIGAke3BhdGh9JHt0aGlzLnNlcH0ke25leHRQYXJ0fWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBuZXh0UGFydDtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZmluZEFsbE1vZGVscyhleHByLCBtb2RlbENsYXNzKSB7XG4gIGNvbnN0IG1vZGVscyA9IFtdO1xuXG4gIGZpbmRBbGxNb2RlbHNJbXBsKGV4cHIsIG1vZGVsQ2xhc3MsIG1vZGVscyk7XG5cbiAgcmV0dXJuIF8udW5pcUJ5KG1vZGVscywgJ3RhYmxlTmFtZScpO1xufVxuXG5mdW5jdGlvbiBmaW5kQWxsTW9kZWxzSW1wbChleHByLCBtb2RlbENsYXNzLCBtb2RlbHMpIHtcbiAgbW9kZWxzLnB1c2gobW9kZWxDbGFzcyk7XG5cbiAgZm9yRWFjaEV4cHIoZXhwciwgbW9kZWxDbGFzcywgKGNoaWxkRXhwciwgcmVsYXRpb24pID0+IHtcbiAgICBmaW5kQWxsTW9kZWxzSW1wbChjaGlsZEV4cHIsIHJlbGF0aW9uLnJlbGF0ZWRNb2RlbENsYXNzLCBtb2RlbHMpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZmluZEFsbFJlbGF0aW9ucyhleHByLCBtb2RlbENsYXNzKSB7XG4gIGNvbnN0IHJlbGF0aW9ucyA9IFtdO1xuXG4gIGZpbmRBbGxSZWxhdGlvbnNJbXBsKGV4cHIsIG1vZGVsQ2xhc3MsIHJlbGF0aW9ucyk7XG5cbiAgcmV0dXJuIF8udW5pcVdpdGgocmVsYXRpb25zLCAobGhzLCByaHMpID0+IGxocyA9PT0gcmhzKTtcbn1cblxuZnVuY3Rpb24gZmluZEFsbFJlbGF0aW9uc0ltcGwoZXhwciwgbW9kZWxDbGFzcywgcmVsYXRpb25zKSB7XG4gIGZvckVhY2hFeHByKGV4cHIsIG1vZGVsQ2xhc3MsIChjaGlsZEV4cHIsIHJlbGF0aW9uKSA9PiB7XG4gICAgcmVsYXRpb25zLnB1c2gocmVsYXRpb24pO1xuXG4gICAgZmluZEFsbFJlbGF0aW9uc0ltcGwoY2hpbGRFeHByLCByZWxhdGlvbi5yZWxhdGVkTW9kZWxDbGFzcywgcmVsYXRpb25zKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGZvckVhY2hFeHByKGV4cHIsIG1vZGVsQ2xhc3MsIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHJlbGF0aW9ucyA9IG1vZGVsQ2xhc3MuZ2V0UmVsYXRpb25BcnJheSgpO1xuXG4gIGlmIChleHByLmlzQWxsUmVjdXJzaXZlKCkgfHwgZXhwci5tYXhSZWN1cnNpb25EZXB0aCgpID4gcmVsYXRpb25SZWN1cnNpb25MaW1pdCkge1xuICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3Ioe1xuICAgICAgZWFnZXI6IGByZWN1cnNpb24gZGVwdGggb2YgZWFnZXIgZXhwcmVzc2lvbiAke2V4cHIudG9TdHJpbmcoKX0gdG9vIGJpZyBmb3IgSm9pbkVhZ2VyQWxnb3JpdGhtYFxuICAgIH0pO1xuICB9XG5cbiAgZm9yIChsZXQgaSA9IDAsIGwgPSByZWxhdGlvbnMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgY29uc3QgcmVsYXRpb24gPSByZWxhdGlvbnNbaV07XG4gICAgY29uc3QgY2hpbGRFeHByID0gZXhwci5jaGlsZEV4cHJlc3Npb24ocmVsYXRpb24ubmFtZSk7XG5cbiAgICBpZiAoY2hpbGRFeHByKSB7XG4gICAgICBjYWxsYmFjayhjaGlsZEV4cHIsIHJlbGF0aW9uLCByZWxhdGlvbi5uYW1lKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlU2luZ2xlSWRHZXR0ZXIoaWRDb2xzKSB7XG4gIGNvbnN0IGlkQ29sID0gaWRDb2xzWzBdO1xuXG4gIHJldHVybiAocm93KSA9PiB7XG4gICAgY29uc3QgdmFsID0gcm93W2lkQ29sXTtcblxuICAgIGlmICghdmFsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGBpZDoke3ZhbH1gO1xuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlVHdvSWRHZXR0ZXIoaWRDb2xzKSB7XG4gIGNvbnN0IGlkQ29sMSA9IGlkQ29sc1swXTtcbiAgY29uc3QgaWRDb2wyID0gaWRDb2xzWzFdO1xuXG4gIHJldHVybiAocm93KSA9PiB7XG4gICAgY29uc3QgdmFsMSA9IHJvd1tpZENvbDFdO1xuICAgIGNvbnN0IHZhbDIgPSByb3dbaWRDb2wyXTtcblxuICAgIGlmICghdmFsMSB8fCAhdmFsMikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgaWQ6JHt2YWwxfSwke3ZhbDJ9YDtcbiAgICB9XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVRocmVlSWRHZXR0ZXIoaWRDb2xzKSB7XG4gIGNvbnN0IGlkQ29sMSA9IGlkQ29sc1swXTtcbiAgY29uc3QgaWRDb2wyID0gaWRDb2xzWzFdO1xuICBjb25zdCBpZENvbDMgPSBpZENvbHNbMl07XG5cbiAgcmV0dXJuIChyb3cpID0+IHtcbiAgICBjb25zdCB2YWwxID0gcm93W2lkQ29sMV07XG4gICAgY29uc3QgdmFsMiA9IHJvd1tpZENvbDJdO1xuICAgIGNvbnN0IHZhbDMgPSByb3dbaWRDb2wzXTtcblxuICAgIGlmICghdmFsMSB8fCAhdmFsMiB8fCAhdmFsMykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgaWQ6JHt2YWwxfSwke3ZhbDJ9LCR7dmFsM31gO1xuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlTklkR2V0dGVyKGlkQ29scykge1xuICByZXR1cm4gKHJvdykgPT4ge1xuICAgIGxldCBpZCA9ICdpZDonO1xuXG4gICAgZm9yIChsZXQgaSA9IDAsIGwgPSBpZENvbHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICBjb25zdCB2YWwgPSByb3dbaWRDb2xzW2ldXTtcblxuICAgICAgaWYgKCF2YWwpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlkICs9IChpID4gMCA/ICcsJyA6ICcnKSArIHZhbDtcbiAgICB9XG5cbiAgICByZXR1cm4gaWQ7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUZpbHRlclF1ZXJ5KHtidWlsZGVyLCBleHByLCByZWxhdGlvbn0pIHtcbiAgY29uc3QgZmlsdGVyUXVlcnkgPSByZWxhdGlvbi5yZWxhdGVkTW9kZWxDbGFzc1xuICAgIC5xdWVyeSgpXG4gICAgLmNoaWxkUXVlcnlPZihidWlsZGVyKTtcblxuICBmb3IgKGxldCBpID0gMCwgbCA9IGV4cHIuYXJncy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICBjb25zdCBmaWx0ZXJOYW1lID0gZXhwci5hcmdzW2ldO1xuICAgIGNvbnN0IGZpbHRlciA9IGV4cHIuZmlsdGVyc1tmaWx0ZXJOYW1lXTtcblxuICAgIGlmICh0eXBlb2YgZmlsdGVyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKHtlYWdlcjogYGNvdWxkIG5vdCBmaW5kIGZpbHRlciBcIiR7ZmlsdGVyTmFtZX1cIiBmb3IgcmVsYXRpb24gXCIke3JlbGF0aW9uLm5hbWV9XCJgfSk7XG4gICAgfVxuXG4gICAgZmlsdGVyKGZpbHRlclF1ZXJ5KTtcbiAgfVxuXG4gIHJldHVybiBmaWx0ZXJRdWVyeTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUmVsYXRlZEpvaW5Gcm9tUXVlcnkoe2ZpbHRlclF1ZXJ5LCByZWxhdGlvbiwgYWxsUmVsYXRpb25zfSkge1xuICBjb25zdCByZWxhdGVkSm9pbkZyb21RdWVyeSA9IGZpbHRlclF1ZXJ5LmNsb25lKCk7XG5cbiAgY29uc3QgYWxsRm9yZWlnbktleXMgPSBmaW5kQWxsRm9yZWlnbktleXNGb3JNb2RlbCh7XG4gICAgbW9kZWxDbGFzczogcmVsYXRpb24ucmVsYXRlZE1vZGVsQ2xhc3MsXG4gICAgYWxsUmVsYXRpb25zXG4gIH0pO1xuXG4gIHJldHVybiByZWxhdGVkSm9pbkZyb21RdWVyeS5zZWxlY3QoYWxsRm9yZWlnbktleXMuZmlsdGVyKGNvbCA9PiB7XG4gICAgcmV0dXJuICFyZWxhdGVkSm9pbkZyb21RdWVyeS5oYXNTZWxlY3Rpb24oY29sKTtcbiAgfSkpO1xufVxuXG5mdW5jdGlvbiBmaW5kQWxsRm9yZWlnbktleXNGb3JNb2RlbCh7bW9kZWxDbGFzcywgYWxsUmVsYXRpb25zfSkge1xuICBsZXQgZm9yZWlnbktleXMgPSBtb2RlbENsYXNzLmdldElkQ29sdW1uQXJyYXkoKS5zbGljZSgpO1xuXG4gIGFsbFJlbGF0aW9ucy5mb3JFYWNoKHJlbCA9PiB7XG4gICAgaWYgKHJlbC5yZWxhdGVkTW9kZWxDbGFzcy50YWJsZU5hbWUgPT09IG1vZGVsQ2xhc3MudGFibGVOYW1lKSB7XG4gICAgICByZWwucmVsYXRlZENvbC5mb3JFYWNoKGNvbCA9PiBmb3JlaWduS2V5cy5wdXNoKGNvbCkpO1xuICAgIH1cblxuICAgIGlmIChyZWwub3duZXJNb2RlbENsYXNzLnRhYmxlTmFtZSA9PT0gbW9kZWxDbGFzcy50YWJsZU5hbWUpIHtcbiAgICAgIHJlbC5vd25lckNvbC5mb3JFYWNoKGNvbCA9PiBmb3JlaWduS2V5cy5wdXNoKGNvbCkpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIF8udW5pcShmb3JlaWduS2V5cyk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZU1vZGVsKHJvdywgcEluZm8sIGtleUluZm9CeVBhdGgpIHtcbiAgY29uc3Qga2V5SW5mbyA9IGtleUluZm9CeVBhdGhbcEluZm8uZW5jUGF0aF07XG4gIGNvbnN0IGpzb24gPSB7fTtcblxuICBmb3IgKGxldCBrID0gMCwgbGsgPSBrZXlJbmZvLmxlbmd0aDsgayA8IGxrOyArK2spIHtcbiAgICBjb25zdCBrSW5mbyA9IGtleUluZm9ba107XG4gICAganNvbltrSW5mby5jb2xdID0gcm93W2tJbmZvLmtleV07XG4gIH1cblxuICByZXR1cm4gcEluZm8ubW9kZWxDbGFzcy5mcm9tRGF0YWJhc2VKc29uKGpzb24pO1xufVxuXG5mdW5jdGlvbiBqb2luVGFibGVGb3JQYXRoKHBhdGgpIHtcbiAgcmV0dXJuIHBhdGggKyAnX2pvaW4nO1xufVxuXG5jbGFzcyBQYXRoSW5mbyB7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5wYXRoID0gbnVsbDtcbiAgICB0aGlzLmVuY1BhdGggPSBudWxsO1xuICAgIHRoaXMuZW5jUGFyZW50UGF0aCA9IG51bGw7XG4gICAgdGhpcy5tb2RlbENsYXNzID0gbnVsbDtcbiAgICB0aGlzLnJlbGF0aW9uID0gbnVsbDtcbiAgICB0aGlzLm9taXRDb2xzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmNoaWxkcmVuID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICB0aGlzLmlkR2V0dGVyID0gbnVsbDtcbiAgfVxuXG4gIGNyZWF0ZUJyYW5jaChwYXJlbnRNb2RlbCkge1xuICAgIGNvbnN0IGJyYW5jaCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgcGFyZW50TW9kZWxbdGhpcy5yZWxhdGlvbi5uYW1lXSA9IGJyYW5jaDtcbiAgICByZXR1cm4gYnJhbmNoO1xuICB9XG5cbiAgZ2V0QnJhbmNoKHBhcmVudE1vZGVsKSB7XG4gICAgcmV0dXJuIHBhcmVudE1vZGVsW3RoaXMucmVsYXRpb24ubmFtZV07XG4gIH1cblxuICBnZXRNb2RlbEZyb21CcmFuY2goYnJhbmNoLCBpZCkge1xuICAgIHJldHVybiBicmFuY2hbaWRdO1xuICB9XG5cbiAgc2V0TW9kZWxUb0JyYW5jaChicmFuY2gsIGlkLCBtb2RlbCkge1xuICAgIGJyYW5jaFtpZF0gPSBtb2RlbDtcbiAgfVxuXG4gIGZpbmFsaXplQnJhbmNoKGJyYW5jaCwgcGFyZW50TW9kZWwpIHtcbiAgICBjb25zdCByZWxNb2RlbHMgPSBfLnZhbHVlcyhicmFuY2gpO1xuICAgIHBhcmVudE1vZGVsW3RoaXMucmVsYXRpb24ubmFtZV0gPSByZWxNb2RlbHM7XG4gICAgcmV0dXJuIHJlbE1vZGVscztcbiAgfVxufVxuXG5jbGFzcyBPbmVUb09uZVBhdGhJbmZvIGV4dGVuZHMgUGF0aEluZm8ge1xuXG4gIGNyZWF0ZUJyYW5jaChwYXJlbnRNb2RlbCkge1xuICAgIHJldHVybiBwYXJlbnRNb2RlbDtcbiAgfVxuXG4gIGdldEJyYW5jaChwYXJlbnRNb2RlbCkge1xuICAgIHJldHVybiBwYXJlbnRNb2RlbDtcbiAgfVxuXG4gIGdldE1vZGVsRnJvbUJyYW5jaChicmFuY2gsIGlkKSB7XG4gICAgcmV0dXJuIGJyYW5jaFt0aGlzLnJlbGF0aW9uLm5hbWVdO1xuICB9XG5cbiAgc2V0TW9kZWxUb0JyYW5jaChicmFuY2gsIGlkLCBtb2RlbCkge1xuICAgIGJyYW5jaFt0aGlzLnJlbGF0aW9uLm5hbWVdID0gbW9kZWw7XG4gIH1cblxuXG4gIGZpbmFsaXplQnJhbmNoKGJyYW5jaCwgcGFyZW50TW9kZWwpIHtcbiAgICBwYXJlbnRNb2RlbFt0aGlzLnJlbGF0aW9uLm5hbWVdID0gYnJhbmNoIHx8IG51bGw7XG4gICAgcmV0dXJuIGJyYW5jaCB8fCBudWxsO1xuICB9XG59XG4iXX0=