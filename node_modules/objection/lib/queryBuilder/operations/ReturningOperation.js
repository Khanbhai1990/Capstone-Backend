'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _flatten = require('lodash/flatten');

var _flatten2 = _interopRequireDefault(_flatten);

var _WrappingQueryBuilderOperation = require('./WrappingQueryBuilderOperation');

var _WrappingQueryBuilderOperation2 = _interopRequireDefault(_WrappingQueryBuilderOperation);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * This class's only purpose is to normalize the arguments as an array.
 *
 * In knex, if a single column is given to `returning` it returns an array with the that column's value
 * in it. If an array is given with a one item inside, the return value is an object.
 */
var ReturningOperation = function (_WrappingQueryBuilder) {
  (0, _inherits3.default)(ReturningOperation, _WrappingQueryBuilder);

  function ReturningOperation() {
    (0, _classCallCheck3.default)(this, ReturningOperation);
    return (0, _possibleConstructorReturn3.default)(this, _WrappingQueryBuilder.apply(this, arguments));
  }

  ReturningOperation.prototype.call = function call(builder, args) {
    args = (0, _flatten2.default)(args);

    // Don't add an empty returning list.
    if (args.length === 0) {
      return false;
    }

    return _WrappingQueryBuilder.prototype.call.call(this, builder, args);
  };

  ReturningOperation.prototype.onBuild = function onBuild(knexBuilder) {
    // Always pass an array of columns to knex.returning.
    knexBuilder.returning(this.args);
  };

  return ReturningOperation;
}(_WrappingQueryBuilderOperation2.default);

exports.default = ReturningOperation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJldHVybmluZ09wZXJhdGlvbi5qcyJdLCJuYW1lcyI6WyJSZXR1cm5pbmdPcGVyYXRpb24iLCJjYWxsIiwiYnVpbGRlciIsImFyZ3MiLCJsZW5ndGgiLCJvbkJ1aWxkIiwia25leEJ1aWxkZXIiLCJyZXR1cm5pbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7Ozs7QUFFQTs7Ozs7O0lBTXFCQSxrQjs7Ozs7Ozs7K0JBRW5CQyxJLGlCQUFLQyxPLEVBQVNDLEksRUFBTTtBQUNsQkEsV0FBTyx1QkFBUUEsSUFBUixDQUFQOztBQUVBO0FBQ0EsUUFBSUEsS0FBS0MsTUFBTCxLQUFnQixDQUFwQixFQUF1QjtBQUNyQixhQUFPLEtBQVA7QUFDRDs7QUFFRCxXQUFPLGdDQUFNSCxJQUFOLFlBQVdDLE9BQVgsRUFBb0JDLElBQXBCLENBQVA7QUFDRCxHOzsrQkFFREUsTyxvQkFBUUMsVyxFQUFhO0FBQ25CO0FBQ0FBLGdCQUFZQyxTQUFaLENBQXNCLEtBQUtKLElBQTNCO0FBQ0QsRzs7Ozs7a0JBaEJrQkgsa0IiLCJmaWxlIjoiUmV0dXJuaW5nT3BlcmF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZsYXR0ZW4gZnJvbSAnbG9kYXNoL2ZsYXR0ZW4nO1xuaW1wb3J0IFdyYXBwaW5nUXVlcnlCdWlsZGVyT3BlcmF0aW9uIGZyb20gJy4vV3JhcHBpbmdRdWVyeUJ1aWxkZXJPcGVyYXRpb24nO1xuXG4vKipcbiAqIFRoaXMgY2xhc3MncyBvbmx5IHB1cnBvc2UgaXMgdG8gbm9ybWFsaXplIHRoZSBhcmd1bWVudHMgYXMgYW4gYXJyYXkuXG4gKlxuICogSW4ga25leCwgaWYgYSBzaW5nbGUgY29sdW1uIGlzIGdpdmVuIHRvIGByZXR1cm5pbmdgIGl0IHJldHVybnMgYW4gYXJyYXkgd2l0aCB0aGUgdGhhdCBjb2x1bW4ncyB2YWx1ZVxuICogaW4gaXQuIElmIGFuIGFycmF5IGlzIGdpdmVuIHdpdGggYSBvbmUgaXRlbSBpbnNpZGUsIHRoZSByZXR1cm4gdmFsdWUgaXMgYW4gb2JqZWN0LlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZXR1cm5pbmdPcGVyYXRpb24gZXh0ZW5kcyBXcmFwcGluZ1F1ZXJ5QnVpbGRlck9wZXJhdGlvbiB7XG5cbiAgY2FsbChidWlsZGVyLCBhcmdzKSB7XG4gICAgYXJncyA9IGZsYXR0ZW4oYXJncyk7XG5cbiAgICAvLyBEb24ndCBhZGQgYW4gZW1wdHkgcmV0dXJuaW5nIGxpc3QuXG4gICAgaWYgKGFyZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1cGVyLmNhbGwoYnVpbGRlciwgYXJncyk7XG4gIH1cblxuICBvbkJ1aWxkKGtuZXhCdWlsZGVyKSB7XG4gICAgLy8gQWx3YXlzIHBhc3MgYW4gYXJyYXkgb2YgY29sdW1ucyB0byBrbmV4LnJldHVybmluZy5cbiAgICBrbmV4QnVpbGRlci5yZXR1cm5pbmcodGhpcy5hcmdzKTtcbiAgfVxufSJdfQ==